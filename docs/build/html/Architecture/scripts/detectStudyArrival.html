

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>detectStudyArrival.sh &mdash; FionaDocs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=ac94c67f" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">
{
    "theme": "neutral",
    "themeVariables": {
        "primaryColor": "#ff0000"
    }
}
</script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            FionaDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../EndUser/index.html">END USER</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#fiona-system">Fiona system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#new-project-creation-setup-and-access">New project: creation, setup and access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#apply-for-a-new-project">Apply for a new project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#access-to-redcap-for-structured-data">Access to REDCap for structured data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#access-to-the-sectra-dma-forskning-research-pacs-viewer">Access to the “Sectra DMA Forskning” research PACS viewer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#submit-data-to-the-research-information-system">Submit data to the Research Information System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#how-to-add-image-data"><strong>How to add image data</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#export-image-data-from-research-pacs">Export image data from research PACS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#research-information-system">Research Information System</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ServerAdmin/index.html">ADMINISTRATION</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ServerAdmin/index.html#end-user-contract">End-user contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ServerAdmin/index.html#features-for-data-migration">Features for data migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ServerAdmin/index.html#how-to-handle-errors">How to handle errors?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ServerAdmin/index.html#export-to-project-specific-formats-nifti-and-zip-files">Export to project specific formats, NIfTI and zip-files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ServerAdmin/index.html#sensitive-data-projects-separation-of-sensitive-information-and-data">Sensitive Data Projects – Separation of Sensitive Information and Data</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ARCHITECTURE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#folder-and-file-structure">Folder and File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#components">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#system-setup-pipeline">System setup pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-flow">Data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-storage-structure">Data Storage Structure</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FionaDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">detectStudyArrival.sh</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Architecture/scripts/detectStudyArrival.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="detectstudyarrival-sh">
<h1>detectStudyArrival.sh<a class="headerlink" href="#detectstudyarrival-sh" title="Link to this heading"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">detectStudyArrival.sh</span></code> is a DICOM processing daemon that monitors for newly arrived medical imaging studies and series. The script runs continuously via cron jobs (every 15 seconds) to detect completed file transfers, performs quality control checks using Docker containers, and manages the archival workflow for both ABCD and PCGC projects. It handles anonymization, phantom QA processing, series compliance validation, and prepares studies for transmission to data centers.</p>
<p><strong>Related Files</strong></p>
<img src="../../_images/mermaid-863f9f09f6ee2814b552e8565e5721a6229f4730.png" alt="flowchart TD
 B[&quot;receiveSingleFile.sh&lt;br&gt;(Creates job directories)&quot;] --&gt; A[&quot;detectStudyArrival.sh&lt;br&gt;(Main Script)&quot;]
 E[&quot;/data/config/config.json&lt;br&gt;(Configuration file)&quot;] --&gt; A
 A --&gt; C[&quot;anonymize.sh&lt;br&gt;(Anonymizes DICOM data)&quot;]
 A --&gt; D[&quot;sendFiles.sh&lt;br&gt;(Sends processed data)&quot;]
 A --&gt; F[&quot;Docker: ABCDPhantomQC&lt;br&gt;(Phantom quality control)&quot;]
 A --&gt; G[&quot;Docker: compliance_check&lt;br&gt;(Series compliance validation)&quot;]
 A --&gt; H[&quot;/tmp/.processSingleFilePipe&lt;br&gt;(Processing queue)&quot;]
 A --&gt; I[&quot;/var/www/html/applications/&lt;br&gt;Assign/incoming.txt&lt;br&gt;(Web interface queue)&quot;]

 %% Styling
 classDef inputFile fill:#e1f5fe
 classDef outputFile fill:#f3e5f5
 classDef mainScript fill:#fff3e0

 class A mainScript
 class B,E inputFile
 class C,D,F,G,H,I outputFile" />
<p><strong>Data Flow Diagram</strong></p>
<img src="../../_images/mermaid-507dbae468ddceaf789bdd274e64ead02f7bc024.png" alt="flowchart TD
 A[&quot;/data/site/.arrived/&lt;br&gt;(Job trigger files)&quot;] --&gt; B[&quot;detectStudyArrival.sh&lt;br&gt;(Main Processing)&quot;]
 C[&quot;/data/site/raw/&lt;br&gt;(Raw DICOM data)&quot;] --&gt; B
 D[&quot;/data/config/config.json&lt;br&gt;(Configuration)&quot;] --&gt; B

 B --&gt; E[&quot;/data/site/archive/&lt;br&gt;(Archived studies)&quot;]
 B --&gt; F[&quot;/data/site/output/&lt;br&gt;(Processing results)&quot;]
 B --&gt; G[&quot;/data/quarantine/&lt;br&gt;(Quarantine area)&quot;]
 B --&gt; H[&quot;/data/PFILEDIR/&lt;br&gt;(Processed files)&quot;]
 B --&gt; I[&quot;Log files&lt;br&gt;(Processing logs)&quot;]
 B --&gt; J[&quot;/var/www/html/applications/&lt;br&gt;Assign/incoming.txt&lt;br&gt;(Web interface)&quot;]

 %% Styling
 classDef inputFile fill:#e1f5fe
 classDef outputFile fill:#f3e5f5
 classDef mainScript fill:#fff3e0

 class A,C,D inputFile
 class B mainScript
 class E,F,G,H,I,J outputFile" />
<p>Data paths</p>
<ul>
<li><p>Input Directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/data/site/.arrived/</span></code> - Job trigger files created by receiveSingleFile.sh</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/site/raw/</span></code> - Raw DICOM data from scanners</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/config/config.json</span></code> - System configuration file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/site/archive/</span></code>- Archived study data for processing</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Output Directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/data/site/output/</span></code> - Processing results and QC reports</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/quarantine/</span></code> - Temporary storage for processed series</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/PFILEDIR/</span></code> - Final processed files ready for transmission</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/www/html/applications/Assign/incoming.txt</span></code> - Web interface study queue</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${SERVERDIR}/logs/</span></code> - Processing and error logs</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Project-specific paths (for non-ABCD projects like PCGC):</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/data{PROJNAME}/site/.arrived/</span></code> - Project-specific job triggers Project-specific DATADIR and PFILEDIR from config.json</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<hr class="docutils" />
<p>Script docstring starts here —&gt;&gt;&gt;
–&gt;&gt;
–&gt;&gt;</p>
<p>check the study job directory created by receiveSingleFile.sh</p>
<p>if the file is old enough process it using the information provided</p>
<p>Add this to “crontab -e” to check every 15 seconds if a new job arrived.</p>
<div class="line-block">
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">30;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">15;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">45;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span> <span class="pre">PCGC</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">30;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span> <span class="pre">PCGC</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">15;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span> <span class="pre">PCGC</span></code></div>
<div class="line">- <code class="docutils literal notranslate"><span class="pre">*/1</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">*</span> <span class="pre">sleep</span> <span class="pre">45;</span> <span class="pre">/data/code/bin/detectStudyArrival.sh</span> <span class="pre">PCGC</span></code></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hauke Bartsch.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>