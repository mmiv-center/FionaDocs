

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARCHITECTURE &mdash; FionaDocs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=ac94c67f" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">
{
    "theme": "neutral",
    "themeVariables": {
        "primaryColor": "#ff0000"
    }
}
</script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="ADMINISTRATION" href="../ServerAdmin/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            FionaDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../EndUser/index.html">END USER</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../EndUser/index.html#fiona-system">Fiona system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../EndUser/index.html#new-project-creation-setup-and-access">New project: creation, setup and access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../EndUser/index.html#apply-for-a-new-project">Apply for a new project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../EndUser/index.html#access-to-redcap-for-structured-data">Access to REDCap for structured data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../EndUser/index.html#access-to-the-sectra-dma-forskning-research-pacs-viewer">Access to the â€œSectra DMA Forskningâ€ research PACS viewer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../EndUser/index.html#submit-data-to-the-research-information-system">Submit data to the Research Information System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../EndUser/index.html#how-to-add-image-data"><strong>How to add image data</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../EndUser/index.html#export-image-data-from-research-pacs">Export image data from research PACS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../EndUser/index.html#research-information-system">Research Information System</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ServerAdmin/index.html">ADMINISTRATION</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ServerAdmin/index.html#end-user-contract">End-user contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ServerAdmin/index.html#features-for-data-migration">Features for data migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ServerAdmin/index.html#how-to-handle-errors">How to handle errors?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ServerAdmin/index.html#export-to-project-specific-formats-nifti-and-zip-files">Export to project specific formats, NIfTI and zip-files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ServerAdmin/index.html#sensitive-data-projects-separation-of-sensitive-information-and-data">Sensitive Data Projects â€“ Separation of Sensitive Information and Data</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ARCHITECTURE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#folder-and-file-structure">Folder and File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#components">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-setup-pipeline">System setup pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-flow">Data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-storage-structure">Data Storage Structure</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FionaDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">ARCHITECTURE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Architecture/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="architecture">
<h1>ARCHITECTURE<a class="headerlink" href="#architecture" title="Link to this heading">ïƒ</a></h1>
<p><strong>For:</strong> Developers, system architects</p>
<div class="toctree-wrapper compound">
</div>
<p><strong>FIONA System Architecture</strong></p>
<p>A detailed system architecture including all system components is presented below</p>
<figure class="align-default" id="id1">
<img src="../_images/mermaid-d232899be5c16d633f58ea5dd0508da7ba94305f.png" alt="flowchart TD
     subgraph network [&quot; &lt;b&gt;Network Layer&lt;/b&gt; &quot;]
         PACS[ğŸ“¡ Clinical PACS&lt;br/&gt;DICOM File Source]
         StoreSCP[ğŸ“¥ storescpFIONA&lt;br/&gt;DICOM SCP]
         MPPS[ğŸ“‹ MPPS Service&lt;br/&gt;mppsctl.sh]
     end

     subgraph processing [&quot; &lt;b&gt;Processing Layer&lt;/b&gt; &quot;]
         ProcessFile[ğŸ”„ processSingleFile3.py&lt;br/&gt;DICOM Processing]
         Classification[âš™ï¸ Classification&lt;br/&gt;Rule Engine]
         ProcessTiff[ğŸ–¼ï¸ process_tiff.sh&lt;br/&gt;Pathology + Anonymization]
         PopulateIncoming[ğŸ“Š populateIncoming.py&lt;br/&gt;REDCap Population]
         PopulateProjects[ğŸ—‚ï¸ populateProjects.py&lt;br/&gt;Project Distribution]
         PopulateAutoID[ğŸ”¢ populateAutoID.py&lt;br/&gt;Auto ID Generation]
         RunJobs[âš™ï¸ runOneJob.sh&lt;br/&gt;Workflow Execution]
         NamedPipe((Named Pipe))
     end

     subgraph storage [&quot; &lt;b&gt;Storage Layer&lt;/b&gt; &quot;]
         FileSystem[ğŸ’¾ File System&lt;br/&gt;/data/site/]
         SymLinks[ğŸ”— Symbolic Links&lt;br/&gt;Study/Series]
         Archive[ğŸ“š Archive Management&lt;br/&gt;clearOldFiles.sh]
         Inventory[ğŸ“‹ PACS Inventory&lt;br/&gt;whatIsInIDS7.py]
         ValidationCleanup[ğŸ§¹ Data Validation&lt;br/&gt;whatIsNotInIDS7.py]
         GetPatients[ğŸ‘¥ Patient Data&lt;br/&gt;getAllPatients2.sh]
         ParsePatients[ğŸ“Š Parse Patient Data&lt;br/&gt;parseAllPatients.sh]
         StaleLinks[ğŸ”— Link Cleanup&lt;br/&gt;clearStaleLinks.sh]
     end

     subgraph transfer [&quot; &lt;b&gt;Transfer Layer&lt;/b&gt; &quot;]
         CreateRequests[ğŸ“ createTransferRequests.py&lt;br/&gt;Transfer Management]
         Anonymize[ğŸ”’ anonymizeAndSend.py&lt;br/&gt;Main Anonymization]
         CreateZip[ğŸ“¦ createZipFileCmd.php&lt;br/&gt;Export Anonymization]
         SendFiles[ğŸ“¤ sendFiles.sh&lt;br/&gt;SFTP Transfer]
         ResendProject[ğŸ”„ resendProject.py&lt;br/&gt;Retry Logic]
         ResPACS[ğŸ¥ Research PACS&lt;br/&gt;Destination]
         REDCap[(ğŸ—„ï¸ REDCap&lt;br/&gt;Database)]
     end

     subgraph mgmt [&quot; &lt;b&gt;Management Layer&lt;/b&gt; &quot;]
         Heartbeat[ğŸ’“ heartbeat.sh&lt;br/&gt;Health Monitoring]
         CronSystem[â° cron.sh&lt;br/&gt;Event Automation]
         Setup[âš™ï¸ setup.sh&lt;br/&gt;Configuration]
         ClearExports[ğŸ—‘ï¸ clearExports.sh&lt;br/&gt;Export Cleanup]
         S2M[ğŸ”„ s2m.sh&lt;br/&gt;Reprocessing Tool]
     end

     %% Main Data Flow
     PACS --&gt;|DICOM| StoreSCP
     StoreSCP --&gt;|DICOM Files| ProcessFile
     ProcessFile --&gt;|metadata| NamedPipe
     NamedPipe --&gt;|study info| Classification
     ProcessFile --&gt;|pathology images| ProcessTiff
     ProcessTiff --&gt;|anonymized DICOM| FileSystem
     Classification --&gt;|routing| PopulateIncoming
     PopulateIncoming --&gt;|data| REDCap
     PopulateProjects --&gt;|project data| REDCap
     PopulateAutoID --&gt;|auto IDs| REDCap

     %% Storage Operations
     ProcessFile --&gt;|files| FileSystem
     FileSystem --&gt;|organization| SymLinks
     GetPatients --&gt;|patient data| ParsePatients
     ParsePatients --&gt;|parsed data| Inventory
     Inventory --&gt;|validation| ValidationCleanup
     ValidationCleanup --&gt;|cleanup| FileSystem
     Archive --&gt;|cleanup| StaleLinks
     StaleLinks --&gt;|clean links| SymLinks

     %% Transfer Operations
     REDCap --&gt;|transfer rules| CreateRequests
     CreateRequests --&gt;|requests| Anonymize
     SymLinks --&gt;|study data| Anonymize
     Anonymize --&gt;|anonymized DICOM| ResPACS
     CreateZip --&gt;|export archives| SendFiles
     SendFiles --&gt;|SFTP| ResPACS
     ResendProject --&gt;|retry| Anonymize

     %% Management Operations
     Heartbeat -.-&gt;|monitor| StoreSCP
     Heartbeat -.-&gt;|monitor| ProcessFile
     CronSystem -.-&gt;|automate| PopulateIncoming
     CronSystem -.-&gt;|automate| CreateRequests
     Archive -.-&gt;|cleanup| FileSystem
     ClearExports -.-&gt;|cleanup| SendFiles
     Setup -.-&gt;|configure| FileSystem
     Setup -.-&gt;|configure| StoreSCP
     S2M --&gt;|reprocess| ProcessFile

     %% Workflow Integration
     RunJobs --&gt;|analysis results| ResPACS

     %% Styling
     classDef network fill:#fff3e0,stroke:#e65100,stroke-width:2px
     classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
     classDef storage fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
     classDef transfer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
     classDef mgmt fill:#ffebee,stroke:#d32f2f,stroke-width:2px
     classDef pipe fill:#ffeb3b,stroke:#f57f17,stroke-width:2px

     class PACS,StoreSCP network
     class ProcessFile,Classification,ProcessTiff,PopulateIncoming,PopulateProjects,PopulateAutoID,RunJobs process
     class FileSystem,SymLinks,Archive,Inventory,ValidationCleanup,GetPatients,ParsePatients,StaleLinks storage
     class CreateRequests,Anonymize,CreateZip,SendFiles,ResendProject,ResPACS,REDCap transfer
     class Heartbeat,CronSystem,Setup,ClearExports,S2M mgmt
     class NamedPipe pipe" />
<figcaption>
<p><span class="caption-text">FIONA layered Architecture</span><a class="headerlink" href="#id1" title="Link to this image">ïƒ</a></p>
</figcaption>
</figure>
<p><a class="reference download internal" download="" href="../_downloads/1f7b0a49932f7850f32f6253315e1487/fiona-layers.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Dowlnoad</span> <span class="pre">image</span> <span class="pre">as</span> <span class="pre">PDF</span></code></a></p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">ïƒ</a></h2>
<p>To setup the system some mandatory information must be set set in <code class="docutils literal notranslate"><span class="pre">/data/config/conf.json</span></code> file. Fill values appropriate to your serwer as shown in example json file.</p>
<div class="literal-block-wrapper docutils container" id="config-json">
<div class="code-block-caption"><span class="caption-text">System configuration example settings</span><a class="headerlink" href="#config-json" title="Link to this code">ïƒ</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="nt">&quot;DICOMIP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_dicom_server_ip&quot;</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;DICOMPORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dicom_port&quot;</span><span class="p">,</span>
</span><span class="linenos"> 4</span><span class="w">    </span><span class="nt">&quot;DICOMAETITLE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FIONA&quot;</span><span class="p">,</span>
<span class="hll"><span class="linenos"> 5</span><span class="w">    </span><span class="nt">&quot;SCANNERIP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scanner_ip&quot;</span><span class="p">,</span>
</span><span class="linenos"> 6</span><span class="w">    </span><span class="nt">&quot;SCANNERPORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scanner_port&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">&quot;SCANNERAETITLE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scanner_application_entity_title&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">&quot;SCANNERTYPE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scanner_device_type&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">&quot;MPPSPORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;modality_performed_procedure_step_port&quot;</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">&quot;SERVERUSER&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;server_user_name&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">&quot;DAICSERVER&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;daic_server_ip&quot;</span><span class="p">,</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">&quot;PFILEDIR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/your/profile/directory&quot;</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">    </span><span class="nt">&quot;CONNECTION&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">    </span><span class="nt">&quot;DATADIR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/data/dir&quot;</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">&quot;LOCALTIMEZONE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_local_zone&quot;</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">&quot;PROCESSING_USER&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;processing_user_name&quot;</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">&quot;PROJECTTOKEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_project_token&quot;</span><span class="p">,</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">&quot;Authentication&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">	</span><span class="nt">&quot;Table-based&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span>
<span class="linenos">20</span><span class="w">	</span><span class="nt">&quot;LDAP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">21</span><span class="w">	    </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">		</span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="linenos">23</span><span class="w">		</span><span class="nt">&quot;connection&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span><span class="p">,</span>
<span class="linenos">24</span><span class="w">		</span><span class="nt">&quot;certificate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span><span class="p">,</span>
<span class="linenos">25</span><span class="w">		</span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span><span class="p">,</span>
<span class="linenos">26</span><span class="w">		</span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span><span class="p">,</span>
<span class="linenos">27</span><span class="w">		</span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span><span class="p">,</span>
<span class="linenos">28</span><span class="w">		</span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your_value&quot;</span>
<span class="linenos">29</span><span class="w">	    </span><span class="p">},</span>
<span class="linenos">30</span><span class="w">	</span><span class="p">]</span>
<span class="linenos">31</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">32</span><span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="folder-and-file-structure">
<h2>Folder and File structure<a class="headerlink" href="#folder-and-file-structure" title="Link to this heading">ïƒ</a></h2>
<pre>
/home/processing/
|          â””â”€â”€ bin/
â”‚               â”œâ”€â”€ <a href="scripts/anonymizeAndSend.html">anonymizeAndSend.py</a>
â”‚               â”œâ”€â”€ <a href="scripts/clearExports.html">clearExports.sh</a>
â”‚               â”œâ”€â”€ <a href="scripts/clearOldFiles.html">clearOldFiles.sh</a>
â”‚               â”œâ”€â”€ <a href="scripts/clearStaleLinks.html">clearStaleLinks.sh</a>
â”‚               â”œâ”€â”€ <a href="scripts/createTransferRequestsForProcessed.html">createTransferRequestsForProcessed.py</a>
â”‚               â”œâ”€â”€ <a href="scripts/createTransferRequests.html">createTransferRequests.py</a>
â”‚               â”œâ”€â”€ <a href="scripts/populateAutoID.html">populateAutoID.py</a>
â”‚               â”œâ”€â”€ <a href="scripts/populateIncoming.html">populateIncoming.py</a>
â”‚               â”œâ”€â”€ <a href="scripts/populateProjects.html">populateProjects.py</a>
â”‚               â””â”€â”€ utils/
â”‚                      â”œâ”€â”€ <a href="scripts/getAllPatients2.html">getAllPatients2.sh</a>
â”‚                      â”œâ”€â”€ <a href="scripts/parseAllPatients.html">parseAllPatients.sh</a>
â”‚                      â”œâ”€â”€ <a href="scripts/resendProject.html">resendProject.py</a>
â”‚                      â”œâ”€â”€ <a href="scripts/whatIsInIDS7.html">whatIsInIDS7.py</a>
â”‚                      â””â”€â”€ <a href="scripts/whatIsNotInIDS7.html">whatIsNotInIDS7.py</a>
â”‚
/var/
  â””â”€â”€ www/
       â””â”€â”€ html/
             â”œâ”€â”€ applications/
             â”‚          â”œâ”€â”€ Assign/
             â”‚          â”‚     â””â”€â”€ php
             |          |          â””â”€â”€<a href="scripts/removeOldEntries.html">removeOldEntries.sh</a>
             â”‚          â”œâ”€â”€ Attach/
             â”‚          â”‚     â””â”€â”€ <a href="scripts/process_tiff.html">process_tiff.sh</a>
             â”‚          â”œâ”€â”€ Exports/
             â”‚          â”‚     â””â”€â”€ php
             |          |          â””â”€â”€<a href="scripts/createZipFileCmd.html">createZipFileCmd.php</a>
             â”‚          â”œâ”€â”€ User/
             â”‚          â”‚     â””â”€â”€ asttt/
             â”‚          â”‚            â””â”€â”€ code/
             â”‚          â”‚                  â””â”€â”€ <a href="scripts/cron.html">cron.sh</a>
             â”‚          â””â”€â”€ Workflows/
             â”‚                 â””â”€â”€php
             |                    â””â”€â”€ <a href="scripts/runOneJob.html">runOneJob.sh</a>
             â”‚
             â””â”€â”€ server/
                    â”œâ”€â”€ bin/
                    |    â”œâ”€â”€ <a href="scripts/heartbeat.html">heartbeat.sh</a>
                    |    â”œâ”€â”€ <a href="scripts/processSingleFile3.html">processSingleFile3.py</a>
                    |    â”œâ”€â”€ <a href="scripts/sendFiles.html">sendFiles.sh</a>
                    |    â””â”€â”€ <a href="scripts/storectl.html">storectl.sh</a>
                    |
                    â””â”€â”€ utils/
                          â””â”€â”€ <a href="scripts/s2m.html">s2m.sh</a>

</pre></section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Link to this heading">ïƒ</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="scripts/anonymizeAndSend.html"><span class="doc">anonymizeAndSend.py</span></a> - Processes imaging studies, performs anonymization, and sends them to research PACS</p></li>
<li><p><a class="reference internal" href="scripts/clearExports.html"><span class="doc">clearExports.sh</span></a> - Removes old export files when storage reaches capacity thresholds</p></li>
<li><p><a class="reference internal" href="scripts/clearOldFiles.html"><span class="doc">clearOldFiles.sh</span></a> - Removes old studies from <code class="docutils literal notranslate"><span class="pre">/data/site/archive</span></code> when disk usage exceeds 80%</p></li>
<li><p><a class="reference internal" href="scripts/clearStaleLinks.html"><span class="doc">clearStaleLinks.sh</span></a> - Removes broken symbolic links and empty directories from data structures</p></li>
<li><p><a class="reference internal" href="scripts/createTransferRequests.html"><span class="doc">createTransferRequests.py</span></a> - Generates transfer requests for studies that need anonymization and forwarding to research projects</p></li>
<li><p><a class="reference internal" href="scripts/createTransferRequestsForProcessed.html"><span class="doc">createTransferRequestsForProcessed.py</span></a> - Handles transfer requests for processed/derived imaging data from workstations back to research PACS</p></li>
<li><p><a class="reference internal" href="scripts/createZipFileCmd.html"><span class="doc">createZipFileCmd.php</span></a> -  Creates anonymized ZIP archives for research data distribution</p></li>
<li><p><a class="reference internal" href="scripts/cron.html"><span class="doc">cron.sh</span></a> - Processes trigger-action pairs from JSON configuration files for event-driven automation</p></li>
<li><p><a class="reference internal" href="scripts/getAllPatients2.html"><span class="doc">getAllPatients2.sh</span></a> - Retrieves patient and study information from research PACS using findscu</p></li>
<li><p><a class="reference internal" href="scripts/heartbeat.html"><span class="doc">heartbeat.sh</span></a> - Checks DICOM service responsiveness and restarts failed components</p></li>
<li><p><a class="reference internal" href="scripts/parseAllPatients.html"><span class="doc">parseAllPatients.sh</span></a> - Parses patient data retrieved by getAllPatients2.sh and extracts study-level metadata for REDCap import</p></li>
<li><p><a class="reference internal" href="scripts/populateAutoID.html"><span class="doc">populateAutoID.py</span></a> -  Generates automatic participant IDs for projects using pseudonymized identifiers</p></li>
<li><p><a class="reference internal" href="scripts/populateIncoming.html"><span class="doc">populateIncoming.py</span></a> - Processes incoming DICOM studies and creates metadata records in REDCap</p></li>
<li><p><a class="reference internal" href="scripts/populateProjects.html"><span class="doc">populateProjects.py</span></a> - Populates individual research project databases with distributed data</p></li>
<li><p><a class="reference internal" href="scripts/processSingleFile3.html"><span class="doc">processSingleFile3.py</span></a> - Extracts metadata from DICOM files and creates directory structures</p></li>
<li><p><a class="reference internal" href="scripts/process_tiff.html"><span class="doc">process_tiff.sh</span></a> - Converts whole slide imaging (WSI) files to DICOM format for pathology processing</p></li>
<li><p><a class="reference internal" href="scripts/removeOldEntries.html"><span class="doc">removeOldEntries.sh</span></a> - Removes old entries from incoming data tracking files</p></li>
<li><p><a class="reference internal" href="scripts/resendProject.html"><span class="doc">resendProject.py</span></a> - Handles re-transmission of studies when initial transfers fail or new data arrives</p></li>
<li><p><a class="reference internal" href="scripts/runOneJob.html"><span class="doc">runOneJob.sh</span></a> - Processes containerized analysis jobs from job queue</p></li>
<li><p><a class="reference internal" href="scripts/s2m.html"><span class="doc">s2m.sh</span></a> - Re-sends DICOM directories through the processing pipeline for re-classification</p></li>
<li><p><a class="reference internal" href="scripts/sendFiles.html"><span class="doc">sendFiles.sh</span></a> - Uploads anonymized data to external research repositories via secure file transfer</p></li>
<li><p><a class="reference internal" href="scripts/storectl.html"><span class="doc">storectl.sh</span></a> - Manages the main DICOM C-STORE receiver daemon</p></li>
<li><p><a class="reference internal" href="scripts/whatIsInIDS7.html"><span class="doc">whatIsInIDS7.py</span></a>- Catalogs all studies present in the research imaging database</p></li>
<li><p><a class="reference internal" href="scripts/whatIsNotInIDS7.html"><span class="doc">whatIsNotInIDS7.py</span></a>- Identifies and removes database entries for studies no longer in PACS</p></li>
</ol>
</section>
<section id="system-setup-pipeline">
<h2>System setup pipeline<a class="headerlink" href="#system-setup-pipeline" title="Link to this heading">ïƒ</a></h2>
<img src="../_images/mermaid-293d21e3f411ff6e1053094a0c6b79a3ac21b34c.png" alt="flowchart TD
    Start([System Boot]) --&gt;  CoreServices[Core Services]

    subgraph CoreServices [Core Services]
        StoreCTL[storectl.sh&lt;br/&gt;DICOM Receiver]
        Process[processSingleFile3.py&lt;br/&gt;Processing Daemon]
    end

    CoreServices --&gt; CronJobs[Cron Jobs]

    subgraph CronJobs [Automatic Tasks]
        Detect[detectStudyArrival.sh&lt;br/&gt;15 seconds]
        Heartbeat[heartbeat.sh&lt;br/&gt;1 minute]
        Populate[populateIncoming.py&lt;br/&gt;5 minutes]
        Transfer[createTransferRequests.py&lt;br/&gt;10 minutes]
        Anonymize[anonymizeAndSend.py&lt;br/&gt;continuous]
        Jobs[runOneJob.sh&lt;br/&gt;job queue]
    end

    CronJobs --&gt; Maintenance[Daily/Hourly Tasks]

    subgraph Maintenance [Maintenance Tasks]
        Projects[populateProjects.py&lt;br/&gt;hourly]
        AutoID[populateAutoID.py&lt;br/&gt;30 minutes]
        SendFiles[sendFiles.sh&lt;br/&gt;30 minutes]
        Cleanup[clearOldFiles.sh&lt;br/&gt;daily]
        ClearExports[clearExports.sh&lt;br/&gt;daily]
        StaleLinks[clearStaleLinks.sh&lt;br/&gt;daily]
        RemoveOld[removeOldEntries.sh&lt;br/&gt;daily]
    end

    Maintenance --&gt; SystemReady[System Ready]

    SystemReady --&gt; EventSystem[cron.sh&lt;br/&gt;Event Automation]

    %% Styling
    classDef network fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef storage fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef transfer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef mgmt fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef system fill:#f0f0f0,stroke:#424242,stroke-width:2px

    class StoreCTL,MPPS network
    class Process,Detect,Populate,Jobs process
    class Cleanup,StaleLinks storage
    class Transfer,Anonymize,SendFiles transfer
    class Setup,Heartbeat,Projects,AutoID,ClearExports,RemoveOld,EventSystem mgmt
    class Start,SystemReady system" />
<p><a class="reference download internal" download="" href="../_downloads/6aa147be5603ee9b835077104fa2f5ba/fiona-sequence.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Dowlnoad</span> <span class="pre">image</span> <span class="pre">as</span> <span class="pre">PDF</span></code></a></p>
</section>
<section id="data-flow">
<h2>Data flow<a class="headerlink" href="#data-flow" title="Link to this heading">ïƒ</a></h2>
<p>Data flow scheme through the FIONA system, from initial DICOM reception to final transfer to research PACS, is presented below.</p>
<img src="../_images/mermaid-33e3dcd610758409c1e1b74133e51b8214305c98.png" alt="flowchart TD
   PACS[&quot;Clinical PACS - DICOM Source&quot;]
   StoreSCP[&quot;storescpFIONA - DICOM SCP&quot;]
   NamedPipe[(&quot;Named Pipe&quot;)]
   Arrived[&quot;Job Directory&quot;]

   ProcessDaemon[&quot;processSingleFile3.py&quot;]
   ClassifyRules[&quot;/data/config/classifyRules.json&quot;]
   RawData[&quot;/data/site/raw/&quot;]
   SymLinks[&quot;Symbolic Links&quot;]

   StudyJob[&quot;Study Job Directory&quot;]
   Anonymize[&quot;anonymize.sh&quot;]
   Archive[&quot;/data/site/archive/&quot;]

   AnonSend[&quot;anonymizeAndSend.py&quot;]
   REDCap[&quot;REDCap API&quot;]
   TransferReq[&quot;Transfer Requests&quot;]

   SendFiles[&quot;sendFiles.sh&quot;]
   Outbox[&quot;/data/outbox/&quot;]
   ResPACS[&quot;Research PACS&quot;]
   DAIC[&quot;/data/DAIC/&quot;]

   PACS --&gt; StoreSCP
   StoreSCP --&gt; NamedPipe
   StoreSCP --&gt; Arrived
   NamedPipe --&gt; ProcessDaemon
   ProcessDaemon --&gt; ClassifyRules
   ProcessDaemon --&gt; RawData
   RawData --&gt; SymLinks

   Arrived --&gt;  StudyJob
   SymLinks --&gt; StudyJob
   StudyJob --&gt; Anonymize
   Anonymize --&gt; Archive

   Archive --&gt; AnonSend
   REDCap --&gt; AnonSend
   AnonSend --&gt;TransferReq
   TransferReq --&gt; SendFiles

   SendFiles --&gt; Outbox
   Outbox --&gt; ResPACS
   ResPACS --&gt; DAIC
   %% Styling
   classDef externalSystem fill:#e1f5fe
   classDef configFile fill:#e1f5fe
   classDef dataDirectory fill:#f3e5f5
   classDef processScript fill:#fff3e0
   classDef tempData fill:#e8f5e8

   class PACS,REDCap,ResPACS externalSystem
   class ClassifyRules configFile
   class RawData,Archive,Outbox,DAIC dataDirectory
   class StoreSCP,ProcessDaemon,Anonymize,AnonSend,SendFiles processScript
   class NamedPipe,Arrived,SymLinks,StudyJob,TransferReq tempData" />
<p>Legend:</p>
<div style="display:flex;gap:20px;flex-wrap:wrap;">
 <span><span style="display:inline-block;width:32px;height:32px;background:#e1f5fe;border:1px solid #ccc;margin-right:5px;"></span>External Systems</span>
 <span><span style="display:inline-block;width:32px;height:32px;background:#f3e5f5;border:1px solid #ccc;margin-right:5px;"></span>Data Directories</span>
 <span><span style="display:inline-block;width:32px;height:32px;background:#fff3e0;border:1px solid #ccc;margin-right:5px;"></span>Scripts & Processes</span>
 <span><span style="display:inline-block;width:32px;height:32px;background:#e8f5e8;border:1px solid #ccc;margin-right:5px;"></span>Temporary Data</span>
 </div>
   <br><br></section>
<section id="data-storage-structure">
<h2>Data Storage Structure<a class="headerlink" href="#data-storage-structure" title="Link to this heading">ïƒ</a></h2>
<p>The FIONA system uses a hierarchical storage structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/data/
â”œâ”€â”€ site/
â”‚   â”œâ”€â”€ .arrived/         # Initial file reception
â”‚   â”œâ”€â”€ archive/          # Raw DICOM storage
â”‚   â”œâ”€â”€ raw/              # Processed DICOM files
â”‚   â””â”€â”€ output/           # Processing results
â”œâ”€â”€ config/               # Configuration files
â””â”€â”€ logs/                 # System logs
</pre></div>
</div>
<p>Project-specific directories follow the pattern:
/data{PROJECT}/site/â€¦</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ServerAdmin/index.html" class="btn btn-neutral float-left" title="ADMINISTRATION" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hauke Bartsch.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>