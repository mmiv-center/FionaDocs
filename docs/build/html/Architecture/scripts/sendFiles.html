

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sendFiles.sh &mdash; FionaDocs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=33ab7645" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">
{
    "theme": "neutral",
    "themeVariables": {
        "primaryColor": "#ff0000"
    }
}
</script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
      <script src="../../_static/custom.js?v=e7cb14c9"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="storectl.sh" href="storectl.html" />
    <link rel="prev" title="s2m.sh" href="s2m.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            FionaDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../EndUser/index.html">END USER</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#fiona-system">Fiona system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#research-information-system">Research Information System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#new-project-creation-setup-and-access">New project: creation, setup and access</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#apply-for-a-new-project">Apply for a new project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#access-to-redcap-for-structured-data">Access to REDCap for structured data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#access-to-the-sectra-dma-forskning-research-pacs-viewer">Access to the “Sectra DMA Forskning” research PACS viewer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#submit-data-to-the-research-information-system">Submit data to the Research Information System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#how-to-add-image-data"><strong>How to add image data</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#export-image-data-from-research-pacs">Export image data from research PACS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#end-user-contract">End-user contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#sensitive-data-projects">Sensitive Data Projects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#separation-of-sensitive-information-and-data">Separation of Sensitive Information and Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#randomization">Randomization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#e-consent">e-Consent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#automatic-data-exports-from-redcap">Automatic data exports from REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#steps-at-the-end-of-a-redcap-project">Steps at the end of a REDCap project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../EndUser/index.html#external-resources">External resources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#git-hub-repositories">Git-Hub Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../EndUser/index.html#redcap">REDCap</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ServerAdmin/index.html">ADMINISTRATION</a><ul class="simple">
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ARCHITECTURE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../index.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#folder-and-file-structure">Folder and File structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#components">Components</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#system-setup-pipeline">System setup pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-flow">Data flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#data-storage-structure">Data Storage Structure</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FionaDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">ARCHITECTURE</a></li>
      <li class="breadcrumb-item active">sendFiles.sh</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Architecture/scripts/sendFiles.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="sendfiles-sh">
<h1>sendFiles.sh<a class="headerlink" href="#sendfiles-sh" title="Link to this heading"></a></h1>
<p>This bash script automates the secure transfer of compressed DICOM and k-space data files from a local outbox directory to a remote DAIC (Data Analysis and Informatics Center) server using SFTP. The script compares local and remote MD5 checksums to avoid redundant transfers and implements file locking to prevent concurrent executions. It includes error handling for corrupt checksums, symbolic link conflicts, and disk space issues, with comprehensive logging of all operations.</p>
<p><strong>Related Files</strong></p>
<img src="../../_images/mermaid-4aa99d633ed93d3ac00f07943f80d7ce723c016d.png" alt="flowchart LR
 A[&quot;/data/config/config.json&quot;] --&gt; B[&quot;sendFiles.sh&quot;]
 B --&gt; C[&quot;/var/www/html/server/logs/&lt;br&gt;sendFiles.log&quot;]
 B --&gt; D[&quot;/var/www/html/server/bin/&lt;br&gt;CommandScript&quot;]
 B --&gt; E[&quot;/var/www/html/server/bin/&lt;br&gt;CommandScriptMD5s&quot;]
 B --&gt; F[&quot;/var/www/html/server/.pids/&lt;br&gt;sendFiles.lock&quot;]
 G[&quot;crontab&lt;br&gt;(Scheduler)&quot;] --&gt; B

 %% Styling
 classDef inputFile fill:#e1f5fe
 classDef outputFile fill:#f3e5f5
 classDef mainScript fill:#fff3e0

 class A,G inputFile
 class C,D,E,F outputFile
 class B mainScript" />
<p><strong>Data Flow Diagram</strong></p>
<img src="../../_images/mermaid-1765ba2a6f7e1693cc19bd530b6dbb75a1420d7e.png" alt="flowchart LR
 A[&quot;/data/outbox/&lt;br&gt;*.tgz files&quot;] --&gt; B[&quot;sendFiles.sh&quot;]
 C[&quot;/data/outbox/&lt;br&gt;*.md5sum files&quot;] --&gt; B
 B --&gt; D[&quot;SFTP Transfer&lt;br&gt;to DAIC Server&quot;]
 D --&gt; E[&quot;Remote DAIC Server&lt;br&gt;/data/outbox/&quot;]
 B --&gt; F[&quot;/data/DAIC/&lt;br&gt;(Permanent Storage)&quot;]
 G[&quot;Remote MD5 Cache&lt;br&gt;md5server_cache.tar&quot;] --&gt; B
 B --&gt; H[&quot;/var/www/html/server/logs/&lt;br&gt;sendFiles.log&quot;]
 B --&gt; I[&quot;Shadow Copy Files&lt;br&gt;*.tgz shadow_copy&quot;]

 %% Styling
 classDef inputFile fill:#e1f5fe
 classDef outputFile fill:#f3e5f5
 classDef mainScript fill:#fff3e0

 class A,C,G inputFile
 class E,F,H,I outputFile
 class B mainScript" />
<p>Data Paths</p>
<ul>
<li><p>Input Directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/data/outbox/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/data/config/config.json</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Output Directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/data/DAIC/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/www/html/server/logs/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/www/html/server/.pids/</span></code></p></li>
<li><p>Remote DAIC server endpoint (specified in config.json)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Temporary Directories:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/md5sums_server_XXXX</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<hr class="docutils" />
<section id="id1">
<h2>sendFiles.sh<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>Example crontab entry that starts this script every 30 minutes</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>*/30 * * * * /usr/bin/nice -n 3 /var/www/html/server/bin/sendFiles.sh
</pre></div>
</div>
<p>Add the above line to your machine using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;<span class="w"> </span>crontab<span class="w"> </span>-e
</pre></div>
</div>
<p>This script is supposed to send compressed data files for DICOM and k-space to the DAIC endpoint using sftp. All data in the /data/outbox directory will be send using local and DAIC md5sum files.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="s2m.html" class="btn btn-neutral float-left" title="s2m.sh" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="storectl.html" class="btn btn-neutral float-right" title="storectl.sh" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hauke Bartsch.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>