parseAllPatients.sh 
~~~~~~~~~~~~~~~~~~~~

This script processes DICOM files to extract unique patient IDs and retrieves study-level information for each patient from a DICOM Query/Retrieve service. It depends on output generated by ``getAllPatients2.sh`` and uses DCMTK tools to parse DICOM files and query a remote PACS server. The script creates a directory structure organizing study information by patient ID and connects to a DICOM server to pull comprehensive study metadata including modalities, dates, and institutional information.


**Related Files**

.. mermaid::

   flowchart TD
    A["getAllPatients2.sh"] --> B["/tmp/allPatients{InstitutionName}/<br>(DICOM files directory)"]
    B --> C["parseAllPatients.sh"]
    C --> D["/tmp/pullStudies{InstitutionName}/<br>(output directory)"]
    C --> E["DICOM QR SCP server"]
    F["/usr/share/dcmtk/dicom.dic<br>(DICOM dictionary)"] --> C
    
    %% Styling
    classDef inputFile fill:#e1f5fe
    classDef outputFile fill:#f3e5f5
    classDef mainScript fill:#fff3e0
    classDef externalService fill:#ffecb3
    
    class A,B,F inputFile
    class D outputFile
    class C mainScript
    class E externalService



**Data Flow Diagram**

.. mermaid::

   flowchart TD
    A["/tmp/allPatients{InstitutionName}/<br>(input DICOM files)"] --> B["parseAllPatients.sh"]
    B --> C["Unique Patient IDs"]
    C --> D["findscu queries<br>(per patient)"]
    D --> E["DICOM server"]
    E --> F["Study metadata<br>(DICOM responses)"]
    F --> G["/tmp/pullStudies{InstitutionName}/{index}/<br>(organized study files)"]
    
    %% Styling
    classDef inputFile fill:#e1f5fe
    classDef outputFile fill:#f3e5f5
    classDef mainScript fill:#fff3e0
    classDef dataFlow fill:#e8f5e8
    classDef externalService fill:#ffecb3
    
    class A inputFile
    class G outputFile
    class B mainScript
    class C,D,F dataFlow
    class E externalService


Data paths

- Input Directories:

* ``/tmp/allPatients{InstitutionName}/`` 
* ``/usr/share/dcmtk/dicom.dic``

Output Directories:

* ``/tmp/pullStudies{InstitutionName}/``
* ``/tmp/pullStudies{InstitutionName}/{index}/`` 








------

.. include:: parseAllPatients.sh 
   :start-after: : '
   :end-before: ' #end-doc
